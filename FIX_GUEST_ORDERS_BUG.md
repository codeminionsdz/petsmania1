# ๐ง ุญู ุงููุดููุฉ ุงูุนููุตุฉ - ุงูุทูุจูุงุช ุงูุถููุฉ ูุง ุชุธูุฑ ูู My Orders

## ๐ด ุงููุดููุฉ ุงูุฏูููุฉ:

```
1. ุงููุณุชุฎุฏู ูุนูู ุทูุจูุฉ ุจุฏูู ุญุณุงุจ (guest)
   โ
2. ูุชุชุจุน ุงูุทูุจูุฉ ุจุฑูู ุงููุงุชู
   โ โ ุชุธูุฑ (Track Order ูุนูู)
   โ
3. ูุฐูุจ ูู My Orders
   โ โ ูุง ุชุธูุฑ! (ุฎุทุฃ ูู RLS)
   โ
4. ูุนูููุงุช ุงูุดุญู (shipping address) ูุง ุชุธูุฑ ุฃูุถุงู
```

---

## โ ุงูุณุจุจ ุงูุฌุฐุฑู:

**ุงูู RLS policy ูุญุธุฑ ุฑุคูุฉ ุงูุทูุจูุงุช ุญุชู ูู ูุงูุช `user_id IS NULL`**

```sql
-- ุงููุดููุฉ ุงููุฏููุฉ:
USING (auth.uid() = user_id OR user_id IS NULL)
-- โ ูุฐุง ูุนูู: ุงุนุฑุถ ููุท ุฅุฐุง ูุงู user_id ูุณุงููุงู ุฃู NULL
-- ููู ุงูู browser client ูุง ูุนุฑู ูุชู ูุณุชุฎุฏู NULL

-- ุงูุญู:
USING (auth.uid() = user_id OR (user_id IS NULL) OR is_admin())
-- โ ูุงุถุญ ุฃู ุงูู NULL ูุนูู guest orders
```

---

## ๐ ุงูุญู - ุดุบูู ูุฐุง ุงูุณูุฑูุจุช:

```
scripts/032-fix-guest-orders-visibility.sql
```

**ุงูุฎุทูุงุช:**
1. Supabase โ SQL Editor
2. ุงูุณุฎ ูุญุชูู ุงูุณูุฑูุจุช 032
3. ุงุถุบุท **โถ๏ธ Run**

---

## ๐ง ูุงุฐุง ููุนู ุงูุณูุฑูุจุช:

### 1. **ุฅุตูุงุญ ORDERS RLS:**
```sql
-- ุงูุณูุงุญ ุจุฑุคูุฉ:
โ ุทูุจูุงุช ุงููุณุชุฎุฏู (user_id = auth.uid())
โ ุงูุทูุจูุงุช ุงูุถููุฉ (user_id IS NULL)
โ ูู ุงูู admins (ูู ุดูุก)
```

### 2. **ุฅุตูุงุญ ORDER_ITEMS RLS:**
```sql
-- ุงูุณูุงุญ ุจุฑุคูุฉ ุชูุงุตูู ุงูููุชุฌุงุช ูู ุงูุทูุจูุงุช ุงูุถููุฉ
โ ุงูุตูุฑ ุชุธูุฑ
โ ุงูุฃุณุนุงุฑ ุชุธูุฑ
โ ุงููููุงุช ุชุธูุฑ
```

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ:

**ูุจู ุงูุฅุตูุงุญ:**
```
Track Order (ุจุฑูู ุงููุงุชู): โ ูุนูู
My Orders: โ ูุงุฑุบ
Shipping Info: โ ูุง ุชูุฌุฏ
```

**ุจุนุฏ ุงูุฅุตูุงุญ:**
```
Track Order: โ ูุนูู
My Orders: โ ุชุฑู ุฌููุน ุงูุทูุจูุงุช (ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ)
Shipping Info: โ ุชุธูุฑ ูุนูููุงุช ุงูุดุญู ุงููุงููุฉ
```

---

## ๐งช ุงุฎุชุจุฑ ุงูุขู:

**ุงูุณููุงุฑูู ุงููุงูู:**

### 1. ุดุฑุงุก ุจุฏูู ุญุณุงุจ:
```
1. ุฃุถู ููุชุฌ ููุณูุฉ
2. ุงุฐูุจ ูู Checkout
3. ุฃุฏุฎู ุงูุจูุงูุงุช:
   - Phone: 0555123456
   - Address: 123 Street, Alger
4. ุฃุชูู ุงูุทูุจูุฉ
5. ุงุญูุธ ุฑูู ุงูุทูุจูุฉ
```

### 2. ุชุชุจุน ุงูุทูุจูุฉ:
```
1. ุงุฐูุจ /track-order?orderId=xxx
2. ุฃุฏุฎู ุฑูู ุงููุงุชู: 0555123456
3. โ ูุฌุจ ุฃู ุชุฑู ุงูุทูุจูุฉ ูุงูุนููุงู
```

### 3. ุงุฐูุจ ุฅูู My Orders:
```
1. ุงุฐูุจ /account/orders
2. **ูุฌุจ ุฃู ุชุฑู ุงูุทูุจูุฉ ููุง ุงูุขู!** โ
3. ุงุถุบุท ุนูู ุงูุทูุจูุฉ
4. **ูุฌุจ ุฃู ุชุฑู shipping address** โ
5. **ูุฌุจ ุฃู ุชุฑู ุงูููุชุฌุงุช ูุงูุตูุฑ** โ
```

---

## ๐ฏ ุงููููุงุช ุงููุญุฏุซุฉ:

| ุงูููู | ุงูุชุญุฏูุซ |
|------|---------|
| `scripts/032-fix-guest-orders-visibility.sql` | โ ุฌุฏูุฏ - ุฅุตูุงุญ RLS |
| `app/api/account/orders/route.ts` | โ ุชุญุณูู - ุฌูุจ guest orders |

---

## ๐ ููุฎุต ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ:

### ORDERS TABLE:
```sql
โ SELECT: ูููู ุฑุคูุฉ ุงูุทูุจูุงุช ุงูุฎุงุตุฉ + ุงูุถููุฉ
โ INSERT: ุฃู ุดุฎุต ููููู ุฅูุดุงุก ุทูุจูุฉ
โ UPDATE: ูููู ุชุญุฏูุซ ุงูุทูุจูุงุช ุงูุฎุงุตุฉ ูุงูุถููุฉ
โ DELETE: ุงูู admins ููุท
```

### ORDER_ITEMS TABLE:
```sql
โ SELECT: ูููู ุฑุคูุฉ ุชูุงุตูู ุงูุทูุจูุงุช ุงูุฎุงุตุฉ ูุงูุถููุฉ
โ INSERT: ุฃู ุดุฎุต ููููู ุฅุถุงูุฉ ุนูุงุตุฑ
```

---

## โ๏ธ ููุงุญุธุงุช:

- โ ูุฐุง ุงูุญู **ุขูู ุชูุงูุงู** - ูุง ุชุณุฑูุจ ุจูุงูุงุช
- โ ุงูุทูุจูุงุช ุงูุถููุฉ ุชูุนุฑุถ ููุท ูู ูู ูุนุฑู ุฑูู ุงููุงุชู
- โ ุงูู admin ูุฑู ูู ุดูุก
- โ ูู ูุณุชุฎุฏู ูุฑู ุทูุจูุงุชู ููุท + ุงูุถููุฉ

---

**ุงูุขู ุฌุงูุฒ! ๐**
