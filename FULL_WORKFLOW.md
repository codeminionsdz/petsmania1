# ๐ ุงูุชุฏูู ุงููุงูู - ูู ุถูู ุฅูู ูุณุชุฎุฏู ูุณุฌู

## โ ุงูุชุฏูู ุงููุทููุจ:

```
1๏ธโฃ ุดุฑุงุก ุจุฏูู ุญุณุงุจ (GUEST)
   โโ ุฅุฏุฎุงู: ุงูุงุณู + ุงููุงุชู + ุงูุนููุงู
   โโ ุงููุชูุฌุฉ: ุทูุจูุฉ ูุน user_id = NULL

2๏ธโฃ ุชุชุจุน ุงูุทูุจูุฉ
   โโ ุงุถุบุท "Track Order"
   โโ ุฃุฏุฎู ุฑูู ุงููุงุชู
   โโ ุชุฑู: ุงูุทูุจูุฉ + ุงูุนููุงู โ

3๏ธโฃ ุฅูุดุงุก ุญุณุงุจ
   โโ ุงุถุบุท "Create Account"
   โโ ุฃุฏุฎู: ุงูุงุณู + ุงููุงุชู (ููุณู!) + ูููุฉ ุงููุฑูุฑ
   โโ ุงููุชูุฌุฉ: ุญุณุงุจ ุฌุฏูุฏ

4๏ธโฃ ุงูุฑุจุท ุงูุชููุงุฆู
   โโ ุงููุธุงู ูุจุญุซ ุนู ุทูุจูุงุช ุจู guest_phone = ุงููุงุชู ุงูุฌุฏูุฏ
   โโ ูุฑุจุทูุง: update user_id = ุงูู ID ุงูุฌุฏูุฏ
   โโ ููุดุฆ ุนููุงู ูู ุงูุทูุจูุฉ ุงููุฏููุฉ

5๏ธโฃ ุงูุชุญูู
   โโ ุงุฐูุจ /account/orders
   โโ ุชุฑู: ุงูุทูุจูุฉ ุงููุฏููุฉ + ูุนูููุงุช ุงูุดุญู โ
```

---

## ๐ด ุงููุดููุฉ ุงูุญุงููุฉ:

**ุงููุณุชุฎุฏู ูุจูู "ุถูู" ุฑุบู ุงูุชุณุฌูู**

ุงูุณุจุจ ุงููุญุชูู:
- โ ุงูู phone ุบูุฑ ูุชุทุงุจู ูู ุงูุทูุจูุฉ ูุงูุญุณุงุจ ุงูุฌุฏูุฏ
- โ ุงูุฑุจุท ูุง ูุญุฏุซ ูุณุจุจ ูุง
- โ ุงูุจูุงูุงุช ุชุถูุน ูู ุงูุทุฑูู

---

## โ ุงูุญู - ููุฎุต ุงูุฎุทูุงุช ุงููุทููุจุฉ:

### **ุงูุฎุทูุฉ 1: ุชุทุจูู RLS Fixes**

ุดุบูู ุนูู Supabase:
```
scripts/032-fix-guest-orders-visibility.sql
```

### **ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุฑุจุท ูุญุฏุซ**

ุฏุนูุง ูุชุญูู ูู ุฃู ุงูููุฏ ูุฑุจุท ุงูุทูุจูุงุช ุจุดูู ุตุญูุญ ุนูุฏ ุงูุชุณุฌูู.

---

## ๐ ูุงุฐุง ูุฌุจ ุฃู ูุญุฏุซ ุฎูู ุงูููุงููุณ:

### ุนูุฏ ุงูุชุณุฌูู (`app/register/page.tsx`):

```typescript
// 1. ุงููุณุชุฎุฏู ูุฏุฎู ุจูุงูุงุช ุจูุง ูููุง ุงููุงุชู
// 2. ููุดุฆ ุญุณุงุจ ุฌุฏูุฏ
// 3. ูุจุญุซ ุนู ุทูุจูุงุช ุจู guest_phone = ุงููุงุชู ุงููุฏุฎู
// 4. ูุฑุจุทูุง: UPDATE orders SET user_id = new_user_id
// 5. ููุดุฆ ุนููุงู ูู ุงูุทูุจูุฉ ุงูุฃููู
```

### ุงูููุฏ ุงูุญุงูู:

```typescript
// Link any guest orders that match the registering phone
const { error: updateError } = await supabase
  .from("orders")
  .update({ user_id: data.user.id })
  .eq("guest_phone", formData.phone)
  .is("user_id", null)
```

โ **ูุฐุง ุตุญูุญ!**

---

## ๐งช ุงุฎุชุจุฑ ูุฐุง:

### ุงุฎุชุจุงุฑ ูุงูู (ูู ุงูุจุฏุงูุฉ):

```
1. ุงูุชุญ ุงููููุน (ูุชุตูุญ ุฌุฏูุฏ / Private)
2. ุงุฐูุจ โ Shop โ ุงุฎุชุฑ ููุชุฌ
3. Cart โ Checkout
4. ููุฃ ุงูุจูุงูุงุช:
   - First Name: ุฃุญูุฏ
   - Last Name: ุจู ุนูู
   - Phone: 0555123456 โญ๏ธ (ุงุญูุธ ูุฐุง ุงูุฑูู)
   - Address: ุดุงุฑุน ุงูุงุณุชููุงู
5. ุฃุชูู ุงูุทูุจูุฉ โ ุงุญูุธ ุฑูู ุงูุทูุจูุฉ (ูุซู: ORD-abc123)
6. ุงุถุบุท "Track Order" ุฃู ุงุฐูุจ /track-order
7. ุฃุฏุฎู ุงููุงุชู: 0555123456 โ ูุฌุจ ุฃู ุชุธูุฑ ุงูุทูุจูุฉ
8. ุงุถุบุท "Create Account"
9. ููุฃ:
   - First Name: ุฃุญูุฏ
   - Last Name: ุจู ุนูู
   - Phone: 0555123456 โญ๏ธ (ููุณู ูู ุงูุทูุจูุฉ!)
   - Password: Test123@
   - Confirm: Test123@
10. ุงุถุบุท "Sign Up"
11. **ุจุนุฏ ุงูุชุณุฌูู**:
    - ุงุฐูุจ /account/orders
    - **ูุฌุจ ุฃู ุชุฑู ุงูุทูุจูุฉ ููุง** โ
    - ุงุถุบุท ุนูููุง
    - **ูุฌุจ ุฃู ุชุฑู ุงูุดุญู ูุงูุนููุงู** โ
```

---

## ๐ ุงูููุงุท ุงูุญุงุณูุฉ:

| ุงูููุทุฉ | ุงูุฃูููุฉ |
|-------|--------|
| **ููุณ ุฑูู ุงููุงุชู** | โญ๏ธโญ๏ธโญ๏ธ ุญุงุณู ุฌุฏุงู |
| **ุงูุทูุจูุฉ ุจู user_id = NULL** | โ ูุฌุจ ุฃู ุชููู ุถููุฉ |
| **RLS Policies** | โ ูุฌุจ ุฃู ุชุณูุญ ุจุฑุคูุฉ guest orders |
| **ุงูุฑุจุท ุงูุชููุงุฆู** | โ ูุฌุจ ุฃู ูุญุฏุซ ุนูุฏ ุงูุชุณุฌูู |

---

## ๐จ ุฅุฐุง ูู ุชุนูู:

### ุงููุดููุฉ: ุงูุทูุจูุฉ ูุง ุชุธูุฑ ูู My Orders

**ุงููุญูุตุงุช:**
1. ุชุญูู: ูู ุงููุงุชู ูุชุทุงุจูุ
2. ุงูุชุญ Browser Console (F12)
3. ุงูุธุฑ: ูู ุธูุฑุช ุฑุณุงูุฉ "Guest orders linked"ุ
4. ูู Supabaseุ ุงูุชุญ `orders` table ูุชุญูู:
   - ูู `user_id` ุชู ููุคูุ
   - ุฃู ุฃูู ุจูู `NULL`ุ

### ุฅุฐุง ุจูู user_id = NULL:

ุงูุฑุจุท ูู ูุญุฏุซ. ุงูุณุจุจ ูุฏ ูููู:
- โ ุงููุงุชู ุบูุฑ ูุชุทุงุจู ุชูุงูุงู
- โ ุงูู RLS ูุญุธุฑ UPDATE
- โ ุฎุทุฃ ูู ุงูู Supabase

---

## โ ุงููููุงุช ุงูุญุงุณูุฉ:

| ุงูููู | ุงูุฏูุฑ |
|------|-------|
| `scripts/032-fix-guest-orders-visibility.sql` | RLS Policies |
| `app/register/page.tsx` | ุงูุฑุจุท ุงูุชููุงุฆู |
| `app/api/account/orders/route.ts` | ุฌูุจ ุงูุทูุจูุงุช |
| `app/track-order/page.tsx` | ุงูุชุชุจุน |

---

**ุงูุขู ูุงุถุญ ุงูุชุฏููุ**

ุงุฎุชุจุฑ ูุฐุง ุงูุณููุงุฑูู ุจุงูุถุจุท ูุดูู ุฅู ูุงู ูุนูู. ุฅุฐุง ูุง ุนููุ ุดุบูู ุงูุณูุฑูุจุช 032 ุฃููุงู! ๐
