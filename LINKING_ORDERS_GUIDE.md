# ๐ฏ ุดุฑุญ ูุธุงู ุฑุจุท ุงูุทูุจูุงุช ูุงูุนูุงููู

## ๐ ููููุฉ ุนูู ุงููุธุงู

### ุงูุณููุงุฑูู ุงููุงูู:

```
1. ุงููุณุชุฎุฏู ูุดุชุฑู ููุชุฌ โ ุจุฏูู ุญุณุงุจ (Guest)
   โ
   ุงูุทูุจูุฉ ุชูุญูุธ ูุน:
   - user_id = NULL (ูุง ููุฌุฏ ุญุณุงุจ)
   - guest_phone = ุฑูู ุงููุงุชู
   - guest_email = ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - shipping_address = ุงูุนููุงู ุงูุฐู ุฃุฏุฎูู

2. ุงููุณุชุฎุฏู ูุถุบุท "ุชุชุจุน ุทูุจูุชู" ๐ฆ
   โ
   ูุฐูุจ ุฅูู ุตูุญุฉ ุงูุชุชุจุน
   โ ูุฑู: "ุฅุฐุง ููุช ูุฏูู ุญุณุงุจุ ุณุฌูู ุฏุฎูู"
   โ ุฃู "ุฅูุดุงุก ุญุณุงุจ ููุชุชุจุน ุจุณูููุฉ"

3. ุงููุณุชุฎุฏู ููุดุฆ ุญุณุงุจ ุฌุฏูุฏ โ
   โ
   ุนูุฏ ุงููุฑ "Sign Up":
   - ููุดุฆ ุญุณุงุจ ุฌุฏูุฏ
   - ููุดุฆ profile ุฌุฏูุฏ
   - ูุจุญุซ ุนู ุทูุจูุงุช ุณุงุจูุฉ ุจููุณ ุงููุงุชู
   - ูุฑุจุท ุฌููุน ุงูุทูุจูุงุช ุงูุณุงุจูุฉ ุฑุจุท ุชููุงุฆู!
   - ููุดุฆ ุนููุงู ูู ุขุฎุฑ ุทูุจูุฉ

4. ุงููุณุชุฎุฏู ูุฐูุจ ุฅูู ุญุณุงุจู ๐ค
   โ
   ูุฑู:
   โ ุงูุทูุจูุฉ ุงููุฏููุฉ ูู "My Orders"
   โ ุงูุนููุงู ูู "Addresses"
   โ ูู ุงูุจูุงูุงุช ูุญููุธุฉ!
```

---

## ๐ ุชูุงุตูู ุงูุชูุงูู

### 1๏ธโฃ ุนูุฏ ุฅูุดุงุก ุทูุจูุฉ (Guest Order)

**ููู**: `app/api/orders/route.ts`

```typescript
// ุงูุทูุจูุฉ ุชูุญูุธ ูุน:
{
  user_id: null,                    // โ ูุง ููุฌุฏ ูุณุชุฎุฏู ุจุนุฏ
  guest_email: "phone-xxx@...",
  guest_phone: "0555123456",
  shipping_address: {
    firstName: "Ahmed",
    lastName: "Benali",
    address: "123 Street",
    city: "Alger",
    wilaya: "Alger",
    phone: "0555123456",
    email: "..."
  }
}
```

### 2๏ธโฃ ุนูุฏ ุงูุชุณุฌูู ุงูุฌุฏูุฏ (Sign Up)

**ููู**: `app/register/page.tsx`

```typescript
// ุชููุงุฆูุงู:

// โ ุงูุฎุทูุฉ 1: ุฑุจุท ุงูุทูุจูุงุช ุจุงููุงุชู
await supabase
  .from("orders")
  .update({ user_id: newUserId })
  .eq("guest_phone", formData.phone)
  .is("user_id", null)

// โ ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุนููุงู ูู ุงูุทูุจูุฉ ุงูุฃููู
const order = linkedOrders[0]
await supabase
  .from("addresses")
  .insert({
    user_id: newUserId,
    address: order.shipping_address.address,
    city: order.shipping_address.city,
    phone: order.shipping_address.phone,
    is_default: true
  })
```

### 3๏ธโฃ ุนูุฏ ุฏุฎูู ุงูุญุณุงุจ (Account Page)

**ููู**: `app/account/page.tsx`

```typescript
// ูุนุฑุถ:
// โ Recent Orders (ูู ุงูุทูุจูุงุช ุงููุฑุชุจุทุฉ)
// โ Profile Info (ูู profiles table)
// โ Addresses (ูู addresses table)
```

---

## โ ูุง ูุฌุจ ุฃู ูุญุฏุซ ุงูุขู

### ูุจู ุงูุชุณุฌูู:
- โ ุงูุทูุจูุฉ ููุฌูุฏุฉ (guest order)
- โ ุงูุนููุงู ูุญููุธ ูู ุงูุทูุจูุฉ ููุท

### ุจุนุฏ ุงูุชุณุฌูู:
- โ ุงูุทูุจูุฉ ุชุธูุฑ ูู "My Orders"
- โ ุงูุนููุงู ูุธูุฑ ูู "Addresses"
- โ ุงูุจุฑูุฏ ูุงููุงุชู ูุธูุฑุงู ูู "Account Settings"

---

## ๐งช ุงุฎุชุจุฑ ูุฐุง:

### 1. ุดุฑุงุก ุจุฏูู ุญุณุงุจ:
```
1. ุงุฐูุจ ุฅูู ุงููุชุฌุฑ
2. ุฃุถู ููุชุฌ
3. ุงุฐูุจ ูู Checkout
4. ุฃุฏุฎู ุงูุจูุงูุงุช (phone + address)
5. ุฃุชูู ุงูุทูุจูุฉ
6. ุณุชูุญุตู ุนูู ุฑูู ุงูุทูุจูุฉ
```

### 2. ุชุชุจุน ุงูุทูุจูุฉ:
```
1. ุงุฐูุจ ุฅูู /track-order?orderId=xxxxx
2. ุฃู ุงุถุบุท "Track Order" ูู ุงูุจุฑูุฏ
3. ูุทูุจ ููู: "Sign in or Create account"
```

### 3. ุฅูุดุงุก ุญุณุงุจ:
```
1. ุงุถุบุท "Create Account"
2. ุฃุฏุฎู:
   - ุงูุงุณู ุงูุฃูู ูุงูุฃุฎูุฑ
   - ุฑูู ุงููุงุชู (ููุณู ูู ุงูุทูุจูุฉ ุงููุฏููุฉ!)
   - ูููุฉ ุงููุฑูุฑ
3. ุงุถุบุท "Sign Up"
```

### 4. ุงููุญุต:
```
1. ุงุฐูุจ ุฅูู /account
   โ ูุฌุจ ุฃู ุชุฑู Recent Orders (ุงูุทูุจูุฉ ุงููุฏููุฉ)

2. ุงุฐูุจ ุฅูู /account/addresses
   โ ูุฌุจ ุฃู ุชุฑู ุงูุนููุงู ูู ุงูุทูุจูุฉ

3. ุงุฐูุจ ุฅูู /account/settings
   โ ูุฌุจ ุฃู ุชุฑู ุงูุจูุงูุงุช ูุญููุธุฉ
```

---

## ๐ ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ:

| ุงููููู | ุงูุฏูุฑ | ุงูุญุงูุฉ |
|-------|-------|--------|
| **guest_phone** | ุฑุจุท ุงูุทูุจูุงุช | โ ูุนูู |
| **guest_email** | ุชุชุจุน ุงูุทูุจูุฉ | โ ูุนูู |
| **shipping_address** | ุญูุธ ุงูุนููุงู | โ ูุนูู |
| **user_id linking** | ุฑุจุท ุนูุฏ ุงูุชุณุฌูู | โ ุชุญุณูู |
| **Auto address creation** | ุฅูุดุงุก ุนููุงู ูู ุงูุทูุจูุฉ | โ ุฌุฏูุฏ |

---

## โ๏ธ ููุงุญุธุงุช ูุงูุฉ:

1. **ุงููุงุชู ููู ุฌุฏุงู**: ูุฌุจ ุฃู ูููู ููุณู ูู ุงูุทูุจูุฉ ูุงูุชุณุฌูู
2. **ุนููุงู ูุงุญุฏ ููุท**: ูุฃุฎุฐ ูู ุขุฎุฑ ุทูุจูุฉ (ูููู ุฅุถุงูุฉ ุฃูุซุฑ ูุฏููุงู)
3. **ุงูุทูุจูุงุช ุงููุฏููุฉ**: ุชุจูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุขููุฉ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ:

- โ `scripts/028-fix-data-saving-rls.sql` (ุงูุณูุฑูุจุช)
- โ `app/register/page.tsx` (ุฑุจุท ุงูุนูุงููู)
- โ `app/account/page.tsx` (ุนุฑุถ ุงูุทูุจูุงุช)
- โ `app/api/account/orders/route.ts` (auto-linking)
